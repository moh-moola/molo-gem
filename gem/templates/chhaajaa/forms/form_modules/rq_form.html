{% load wagtailcore_tags core_tags gem_tags %}

<div class="reaction-questions">
  {% if user.is_authenticated and user.is_active or request.is_preview or form_page.allow_anonymous_submissions %}
    {% if form %}
      {% comment %}
        {{article}}<br/>
        {{form_page.id}}<br/>
      {% endcomment %}

      <form id="{% if not article.get_parent_section.get_parent_section.slug %}reaction-questions__form{% else %}reaction-questions__form_{{form_page.id}}{% endif %}" action="{% pageurl form_page %}" method="post" class="reaction-questions__form" novalidate>
      {% csrf_token %}
        {{ form.media }}
        {% for field in form %}
          {% if field|fieldtype == 'RadioSelect' %}
            <fieldset class="reaction-questions__list {% if self.display_form_directly %}choice-fieldset{% endif %}">
              {% for value, text in field.field.choices %}
                <div class="reaction-questions__item">
                  {% if user_has_chosen %}
                    <input name="{{ field.name }}"
                    id="{{ value|slugify }}_{{ forloop.counter0 }}"
                    type="radio" value="{{ value }}" {% if not article.get_parent_section.get_parent_section.slug %}onclick="set_rq_form_choice('{{ value|slugify }}_{{ forloop.counter0 }}')"{% else %}onclick="set_section_choice('{{ value|slugify }}_{{ forloop.counter0 }}', '{{form_page.id}}')"{% endif %} class="{{ value|slugify }}"/>

                  {% else %}
                    <input name="{{ field.name }}"
                    id="{{ value|slugify }}_{{ forloop.counter0 }}"
                    type="radio" value="{{ value }}"{% if not article.get_parent_section.get_parent_section.slug %}onclick="set_rq_form_choice('{{ value|slugify }}_{{ forloop.counter0 }}')"{% else %}onclick="set_section_choice('{{ value|slugify }}_{{ forloop.counter0 }}', '{{form_page.id}}')"{% endif %} class="{{ value|slugify }}"/>
                  {% endif %}
                   <label class="reaction-questions__label" for="{{ value|slugify }}_{{ forloop.counter0 }}">
                     {{ text|capfirst }}
                   </label>
                </div>
              {% endfor %}
            </fieldset>
          {% endif %}

          {% if field.errors %}
            <ul class="error-list">
            {% for error in field.errors %}
              <li class="error-list__item">{{ error }}</li>
            {% endfor %}
            </ul>
          {% endif %}

        {% endfor %}
        <input id="article_page_id" class="article_page" type="hidden" name="article_page"  value="{{ self.pk }}" />
      </form>
    {% else %}
      <p class="error-list__item">
        {% trans 'You have already completed this poll.' %}
      </p>
    {% endif %}
  {% endif %}
</div>
