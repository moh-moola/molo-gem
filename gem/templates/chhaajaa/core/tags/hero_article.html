{% load wagtailcore_tags core_tags wagtailimages_tags wagtailembeds_tags wagtailsettings_tags gem_tags %}
{% get_settings %}
{% if articles %}
<div class="article-teaser">
  <div class="article-teaser__wrapper">
    <ul class="teaser-stacklist">
      {% for article in articles %}
        <li class="teaser-stacklist__item">
          <div class="teaser-stacklist__iframe">
            {% for block in article.body %}
              {% if block.value.youtube_link %}
                {% embed block.value.youtube_link %}
              {% endif %}
            {% endfor %}
          </div>
          <!-- END ARTICLE MEDIA -->

          <!-- START COMMENT -->
          {% include "comments/comment_block.html"  %}
          <!-- END COMMENT -->

         

      
          <div class="teaser-stacklist__container">
            <a class="teaser-stacklist__anchor" href="{% pageurl article.specific %}">
              <h1 class="teaser-stacklist__title">
                {{ article.title|smarttruncatechars:100|safe}}
              </h1>
            </a>
            <!-- REACTION QUESTION START -->
          {% load_reaction_question article as question %}
          {% if question %}
            <div class="reaction-questions__block">
                    <form class="reaction-questions__form" action="{% url 'reaction-vote' article.slug question.id %}" id="reaction-questions__form" method="post" novalidate>
                      {% csrf_token %}
                      <div class="reaction-questions__list">
                        {% load_choices_for_reaction_question question as choices %}
                            {% for choice in choices %}
                              <!-- if user voted for this choice, then make this div disabled -->
                              <div class="reaction-questions__item" id="{{ choice.specific.get_main_language_page.id }}" onclick="set_choice({{ choice.specific.get_main_language_page.id }})" disabled=enabled>
                                  <label for="choice{{ forloop.counter }}">
                                    <div class="reaction-questions__image">
                                      {% image choice.specific.image width-50 %}
                                    </div>
                                    <div class="reaction-questions__label">
                                      {{ choice.title|capfirst }}
                                    </div>
                                  </label>
                              </div>
                          {% endfor %}
                      </div>
                    </form>
            </div>
            <script type="text/javascript">
              var frm = $('#reaction-questions__form');
              function set_choice(choice){
                if ($('#' + choice).is('[disabled=enabled]')){
                  $.ajax({
                  type: frm.attr('method'),
                  url: frm.attr('action'),
                  data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                    choice: choice,
                    ajax: "True"
                  },
                  success: function () {
                    $("#" + choice).attr('disabled', 'disabled');
                    alert(choice);
                  }
                })
                }
               
              }
            
            </script>
          {% endif %}
          <!-- REACTION QUESTION END -->

            <h4 class="teaser-stacklist__subtitle">{{ article.subtitle|smarttruncatechars:150|safe}}</h4>
            {% for block in article.body %}
              {% if block.block_type == 'paragraph' %}
                <p class="teaser-stacklist__excerpt">
                  {{block.value|smarttruncatechars:350|safe}}
                </p>
              {% endif %}
            {% endfor %}
            <a class="call-to-action__read-more" href="{% pageurl article.specific %}">{% trans "Show more" %}</a>
          </div>
        </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endif %}

