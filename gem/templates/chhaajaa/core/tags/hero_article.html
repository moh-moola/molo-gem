{% load wagtailcore_tags core_tags wagtailimages_tags wagtailembeds_tags wagtailsettings_tags gem_tags %}
{% get_settings %}
{% if articles %}
<div class="article-teaser">
  <div class="article-teaser__wrapper">
    <ul class="teaser-stacklist">
      {% for article in articles %}
        <li class="teaser-stacklist__item">
          <h2 class="article-teaser__title">{{article.title}}</h2>
          <!-- ARTICLE MEDIA -->
          <div class="teaser-stacklist__iframe">
            {% for block in article.body %}
              {% if block.value.youtube_link %}
                {% embed block.value.youtube_link %}
              {% endif %}
            {% endfor %}
          </div>
          <!-- END ARTICLE MEDIA -->

          <!-- START COMMENT -->
          {% include "comments/comment_block.html"  %}
          <!-- END COMMENT -->

          <!-- REACTION QUESTION START -->
          {% load_reaction_question article as question %}
          {% if question %}
            <div class="reaction-questions__block">
                    <form class="reaction-questions__form" action="{% url 'reaction-vote' article.slug question.id %}" id="reaction-questions__form" method="post" novalidate>
                      {% csrf_token %}
                      <div class="reaction-questions__list">
                        {% load_choices_for_reaction_question question as choices %}
                            {% for choice in choices %}
                              <div class="reaction-questions__item" onclick="set_choice({{ choice.specific.get_main_language_page.id }})">
                                  <input type="hidden" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.specific.get_main_language_page.id }}" />
                                  <label for="choice{{ forloop.counter }}">
                                    <div class="reaction-questions__image">
                                      {% image choice.specific.image width-50 %}
                                    </div>
                                    <div class="reaction-questions__label">
                                      {{ choice.title|capfirst }}
                                    </div>
                                  </label>
                              </div>
                          {% endfor %}
                      </div>
                    </form>
            </div>
            <script type="text/javascript">
              var frm = $('#reaction-questions__form');
              function set_choice(choice){
                $.ajax({
                  type: frm.attr('method'),
                  url: frm.attr('action'),
                  data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                    choice: choice
                  },
                  success: function () {
                      // var result = $('<div />').append(data).find('#showresults').html();
                      // $('#showresults').html(result);
                      alert('You have chosen a choice');
                  }
                })
              }
            
            </script>
          {% endif %}


          <!-- REACTION QUESTION END -->

          <div class="teaser-stacklist__container{% if article.get_parent_section.get_effective_extra_style_hints %} teaser-stacklist__container--{{article.get_parent_section.get_effective_extra_style_hints}}{% endif %}">
              <h1 class="teaser-stacklist__title{% if article.title_highlight %} teaser-stacklist__title--highlight{% endif %}">
                {% if article.title_highlight %}{{ article.title_highlight|smarttruncatechars:100|safe}}{% else %}{{ article.title|smarttruncatechars:100|safe}}{% endif %}
              </h1>
            {% if article.subtitle_highlight or article.body_highlight %}
              <p class="teaser-stacklist__subtitle">
                {% if article.subtitle_highlight %}
                  {{article.subtitle_highlight|smarttruncatechars:150|safe}}
                {% elif article.body_highlight %}
                  {{article.body_highlight|smarttruncatechars:150|safe}}
                {% endif %}
              </p>
            {% elif article.subtitle %}
              <p class="teaser-stacklist__subtitle">
                {{ article.subtitle|smarttruncatechars:150|safe}}
              </p>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endif %}

