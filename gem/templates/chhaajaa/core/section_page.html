{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags wagtailembeds_tags wagtailsettings_tags core_tags comments gem_tags %}
{% get_settings %}

{% block content %}
  {% load_child_sections_for_section self as sections %}
  <div class="section-page">
    <div class="section-page__wrapper">
      <div class="section-page__images">
        {% if self.get_effective_image %}
          {% image self.get_effective_image width-200 as section_photo %}
            <img alt="{{ self.title }}" src="{{ section_photo.url }}" class="section-page__thumbnail"/>
        {% else %}
          <span class="section-page__thumbnail--placeholder"></span>
        {% endif %}
      </div>
      {% load_child_articles_for_section sections count=1 featured_in_section=True as featured_articles %}
      <ul class="teaser-stacklist">
        {% for featured_article in featured_articles %}
          <li class="teaser-stacklist__item">
            {% if featured_article.image %}
              <div class="teaser-stacklist__images">
                <a href="{% pageurl featured_article.specific %}" class="teaser-stacklist__anchor">
                  {% image featured_article.image width-1080 format-jpeg as teaser_thumbnail %}
                  <img alt="{{ featured_article.title }}" src="{{ teaser_thumbnail.url }}" class="teaser-stacklist__thumbnail"/>
                </a>
              </div>
            {% endif %}
            <div class="teaser-stacklist__container">
              <h2 class="teaser-stacklist__title-secondary">{{ featured_article.title|smarttruncatechars:50|safe}}</h2>
              <div class="teaser-stacklist__cta-buttons">
                {% load_reaction_question featured_article as question %}
                {% if question %}
                <div class="reaction-questions">
                  <form class="reaction-questions__form" action="{% url 'reaction-vote' article.slug question.id %}" id="reaction-questions__form" method="post" novalidate>
                    {% csrf_token %}
                    <div class="reaction-questions__list">
                      {% load_choices_for_reaction_question question as choices %}
                        {% for choice in choices %}
                          {% load_user_choice_reaction_question question article choice as user_has_chosen %}
                          {% if user_has_chosen %}
                            <span class="reaction-questions__item" id="{{ choice.specific.get_main_language_page.id }}" onclick="set_choice({{ choice.specific.get_main_language_page.id }})" disabled=disabled>
                          {% else %}
                            <span class="reaction-questions__item" id="{{ choice.specific.get_main_language_page.id }}" onclick="set_choice({{ choice.specific.get_main_language_page.id }})">
                          {% endif %}
                              <label for="choice{{ forloop.counter }}" class="reaction-questions__label reaction-questions__label--{{ choice.title|slugify }}">
                                {% image choice.specific.image width-50 as reaction__icon %}
                                <div class="reaction-questions__icon" style="background-image: url('{{reaction__icon.url}}')"></div>
                                {{ choice.title|capfirst }}
                              </label>
                            </span>
                        {% endfor %}
                    </div>
                  </form>
                </div>
              {% endif %}
              <div class="vote__item">
                <a href="#" class="vote__icon"></a>
              </div>
              </div>
              {% if featured_article.subtitle %}
                <h6 class="article-teaser__subtitle">
                  {{ featured_article.subtitle|smarttruncatechars:150|safe}}
                </h6>
              {% endif %}
              <a class="call-to-action__button call-to-action__button--primary" href="{% pageurl featured_article.specific %}">
                {% trans "Read more" %}
              </a>
            </div>
          </li>
        {% endfor %}
      </ul>

      <div class="section-page__columns">
        <div class="section-page__columns-left">
          {% load_child_sections_for_section section=section as child_sections %}
          {% if child_sections %}
            {% for child_section in child_sections %}
                {{child_section.title}}
                <!--LOAD CHILD SECTION PAGE ARTICLES -->
            {% endfor %}
          {% endif %}
        </div>
        <div class="section-page__columns-right">
          <!--EXCLUDE FEATURES ARTICLE -->
        {% load_child_articles_for_section sections as articles %}
          <ul class="teaser-stacklist">
            {% for article in articles %}
            {% if not featured_article %}
              {{article.title}}<br/>
            {% endif %}
              <li class="teaser-stacklist__item">
                {% if article.image %}
                  <div class="article-teaser__images">
                    <a href="{% pageurl article.specific %}" class="article-teaser__anchor">
                      {% image article.image width-480 format-jpeg as teaser_thumbnail %}
                      <img alt="{{ article.title }}" src="{{ teaser_thumbnail.url }}" class="article-teaser__thumbnail"/>
                    </a>
                  </div>
                {% endif %}
                <div class="article-teaser__container">
                  {% get_comment_count for article as comment_count %}
                  {% load_tags_for_article article as tags %}
                  <ul class="teaser-tags">
                    {% if comment_count > 0 %}
                    <li class="teaser-tags__item">
                      <a href="{% pageurl article.specific %}?#comments" class="comments-counter">
                        <span class="comments-counter__numeral">{{comment_count}}</span>
                      </a>
                    </li>
                    {% endif %}
                    {% if tags %}
                      {% if settings.core.SiteSettings.enable_tag_navigation %}
                        {% for tag in tags %}
                          {% if not tag.title.20 %}
                            <li class="teaser-tags__item">
                              <a href="{% url 'tags_list' tag.slug %}" class="teaser-tags__anchor">
                                <span class="teaser-tags__title">{{ tag.title }}</span>
                              </a>
                            </li>
                          {% endif %}
                        {% endfor %}
                      {% elif settings.core.SiteSettings.enable_clickable_tags %}
                        {% for tag in article.tags_list %}
                          <li class="teaser-tags__item">
                            <span class="teaser-tags__title">{{tag}}</span>
                          </li>
                        {% endfor %}
                      {% endif %}
                    {% endif %}
                  </ul>
                  <h3 class="article-teaser__title {% if article.title_highlight %}article-teaser__title--highlight{% endif %}">
                    {% if article.title_highlight %}
                      {{ article.title_highlight|smarttruncatechars:50|safe}}
                    {% else %}
                      {{ article.title|safe}}
                    {% endif %}
                  </h3>
                  {% if article.subtitle_highlight or article.body_highlight %}
                    <h6 class="article-teaser__subtitle">
                      {% if article.subtitle_highlight %}
                        {{article.subtitle_highlight|smarttruncatechars:50|safe}}
                      {% elif article.body_highlight %}
                        {{article.body_highlight|smarttruncatechars:50|safe}}
                      {% endif %}
                    </h6>
                  {% elif article.subtitle %}
                    <h6 class="article-teaser__subtitle">
                      {{ article.subtitle|smarttruncatechars:50|safe}}
                    </h6>
                  {% endif %}
                  {% with article.body|first as block %}
                    {% if block.block_type == 'paragraph' %}
                      <p>{{block.value|smarttruncatechars:150|safe}}</p>
                    {% endif %}
                  {% endwith %}
                  <a class="call-to-action__button call-to-action__button--primary" href="{% pageurl article.specific %}">
                    {% trans "Read article" %}
                  </a>
                </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>


      {% if article and articles_paginated.paginator.num_pages > 1 %}
        <div class="pagination">
        {% if articles_paginated.has_previous %}
          <a href="?p={{ articles_paginated.previous_page_number }}" class="call-to-action__button call-to-action__button--previous">
            {% trans "Previous" %}</a>
        {% endif %}
          <p class="call-to-action__item--text call-to-action__item--text-current">
            {% trans "Page" %} {{ articles_paginated.number }} {% trans "of" %} {{articles_paginated.paginator.num_pages }}
          </p>
        {% if articles_paginated.has_next %}
          <a href="?p={{ articles_paginated.next_page_number }}" class="call-to-action__button call-to-action__button--next">
            {% trans "Newer" %}</a>
        {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
