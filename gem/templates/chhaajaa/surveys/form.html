{% load wagtailcore_tags core_tags gem_tags %}
<form id="survey-form" action="{% pageurl survey %}" method="post" class="polls__form" novalidate>
{% csrf_token %}
  {{ form.media }}
  {% for field in form %}
    {% if field|fieldtype == 'RadioSelect' %}
    <fieldset class="{% if self.display_survey_directly %}choice-fieldset{% endif %}">
      {% for value, text in field.field.choices %}
        <div class="choice-group choice-group__radio">
          <input name="{{ field.name }}"
           id="value-{{ field.id_for_label }}-{{ forloop.counter }}"
           type="radio" value="{{ value }}"
           {% if field.value == value %}checked="checked"{% endif %}
           onclick="set_choice()"/>
           <label for="value-{{ field.id_for_label }}-{{ forloop.counter }}">{{ text|capfirst }}</label>
        </div>
      {% endfor %}
    </fieldset>
    {% endif %}
    {% if field.errors %}
      <ul class="error-list">
      {% for error in field.errors %}
        <li class="error-list__item">{{ error }}</li>
      {% endfor %}
      </ul>
    {% endif %}
  {% endfor %}

  {% trans "Submit" as text %}
  {% trans "Vote" as polltext %}
  {#  The display_survey_directly uses survey instead of self #}
  {% if survey.display_survey_directly %}
    {% if user.is_authenticated or request.is_preview%}
      <button type="submit" class="call-to-action__button call-to-action__button--primary">
        {{ survey.submit_text|default:polltext }}
      </button>
    {% endif %}
  {% endif %}
  
</form>
<script type="text/javascript">
  var frm = $('#survey-form');
  function set_choice(){
    $.ajax({
      type: frm.attr('method'),
      url: frm.attr('action'),
      data: frm.serialize(),
      success: function () {
        alert(frm.serialize());
      },
      error: function () {
        alert('there is an error');
      }
    })
  }
  

</script>