{% load forms_personalise_extras wagtailimages_tags wagtailcore_tags wagtailsettings_tags %}
{% get_settings %}

{% block content %}

{% filter_forms_by_segments forms request as filtered_forms %}
  {% if filtered_forms %}
    {% comment %}
      FORM BANNER -
      New issue: Setting is not longer available
      Old issue: SHOWS AT DIFFERENT FORM TYPE POSITIONS ATM
    {% endcomment %}
    {% with item=filtered_forms|first %}
      {% with form_page=item.molo_form_page %}
        {% if not user.is_authenticated and not request.is_preview and not form_page.allow_anonymous_submissions %}
          {% if  not form_page.your_words_competition and not form_page.display_form_directly %}
            {#{% include "patterns/components/banners/join-banner.html" %}#}
              {% if settings.gem.GemSettings.show_join_banner %}
                <div class="profiles-join-banner">
                  <div class="profiles-join-banner__icon"></div>
                  <div class="profiles-join-banner__content">
                    <div class="heading heading__subheading-alt">
                      <h4>{% trans "Share your opinions and stories, take polls, win fun prizes." %}</h4>
                    </div>
                    <a href="{{ LOGIN_URL }}" class="call-to-action__button call-to-action__button--yellow">
                      <span class="call-to-action__button-text call-to-action__button-text--yellow">{% trans "Join" %}</span>
                    </a>
                  </div>
                </div>
              {% endif %}
            {# end include template #}
          {% endif %}
        {% endif %}
      {% endwith %}
    {% endwith %}

    {% for item in filtered_forms %}
      {% with form_page=item.molo_form_page form=item.form %}
        {% if form_page.your_words_competition and not form_page.personalisableform %}

          {% include 'forms/form_modules/yourwords_landing.html' %}

        {% elif form_page.display_form_directly and not form_page.personalisableform %}

          {% include 'forms/form_modules/polls_landing.html' %}

        {% elif form_page.article_form_only and not form_page.personalisableform %}
          {# ONLY SHOW ON ARTICLE PAGE #}
          --
        {% elif form_page.personalisableform or form_page.personalisableform and form_page.your_words_competition or form_page.personalisableform and form_page.display_form_directly %}

          {% include 'forms/form_modules/surveys_landing.html' %}

        {% else %}

          {% include 'forms/form_modules/surveys_landing.html' %}
        {% endif %}
      {% endwith %}
    {% endfor %}
  {% endif %}

{% endblock %}
