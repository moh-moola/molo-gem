{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags wagtailembeds_tags core_tags gem_tags %}

{% block content %}
  <div class="section-page{% if self.get_effective_extra_style_hints %} section-page--{{self.get_effective_extra_style_hints}}{% endif %}">
    <div class="banner">
      <div class="heading heading--hero">
        <h1 class="heading__title">{{self.title}}</h1>
      </div>
    </div>
    {% with ancestor=self.get_parent_section.get_parent_section parent=self.get_parent_section %}
      {% if ancestor.get_main_language_page.title == "Watch" or  parent.get_main_language_page.title == "Watch" or self.get_main_language_page.title == "Watch" %}
        <div class="section-page__columns section-page__columns--watch">
          <div class="section-page__first-column">
              <div class="heading heading--video">
                <h1 class="heading__component">{% trans "Featured episode" %}</h1>
              </div>
              <div class="article-teaser__wrapper">
                {% load_child_articles_for_section self count=1 as articles %}
                {% if articles %}
                  <ul class="teaser-stacklist teaser-stacklist--watch">
                  {% for article in articles %}
                      <li class="teaser-stacklist__item">
                        {% if article.homepage_media %}
                          {% for block in article.homepage_media %}
                            {% with block.value as media %}
                              <div class="teaser-stacklist__images">
                                {% if block.value.youtube_link %}
                                  {% embed media.youtube_link %}
                                {% elif block.value.type == 'video' %}
                                  <div class="media-player__embed">
                                    <video poster="/media/{{ media.thumbnail }}" controls>
                                      <source src={{media.file.url}} type="video/mp4">
                                      <source src={{media.file.url}} type="video/webm">
                                      <source src={{media.file.url}} type="video/ogg">
                                      <span class="media-player__caption">
                                        {% trans "Your browser does not support the video tag." %}
                                      </span>
                                    </video>
                                  </div>
                                {% endif %}
                              </div>
                            {% endwith %}
                          {% endfor %}
                        {% elif article.get_effective_image %}
                          <div class="teaser-stacklist__images">
                            <a href="{% pageurl article.specific %}" class="teaser-stacklist__anchor">
                              {% image article.get_effective_image width-480 format-jpeg as teaser_thumbnail %}
                              <img alt="{{ article.title }}" src="{{ teaser_thumbnail.url }}" class="teaser-stacklist__thumbnail" />
                            </a>
                          </div>
                        {% endif %}
                        {% include "core/section_page-partials/section_video-article-teaser.html" %}
                      </li>
                  {% endfor %}
                  </ul>
                {% endif %}
                {% comment %}
                <!--
                TAG DOES NOT SUPPORT FEATURED_IN_SECTION ARGUMENT
                'load_child_articles_for_section' received unexpected keyword argument 'featured_in_section'


                {% get_next_article next_article as other_next_articles %}
                {{other_next_articles}}>

                -->
                {% endcomment %}

                {% load_descendant_articles_for_section self count=2 featured_in_section=True as next_articles %}
                {% if self.get_parent_section.enable_next_section == True and next_articles %}
                  <div class="article-teaser article-teaser--related">
                    <div class="heading">
                      <h1 class="heading__title">{% trans "Watch next" %}</h1>
                    </div>
                    {% for next_article in next_articles %}

                      <ul class="teaser-stacklist">
                        <li class="teaser-stacklist__item">
                          {% if next_article.image %}
                            <div class="article-teaser__images">
                              <a href="{% pageurl next_article.specific %}" class="teaser-stacklist__anchor">
                                {% image next_article.image width-480 format-jpeg class="article-teaser__thumbnail" %}
                              </a>
                            </div>
                          {% endif %}
                          <div class="teaser-stacklist__container">
                            {% load_tags_for_article next_article as tags %}
                              <ul class="teaser-tags">
                                {% if tags %}
                                  {% if settings.core.SiteSettings.enable_tag_navigation %}
                                    {% for tag in tags %}
                                      {% if not tag.title.20 %}
                                        <li class="teaser-tags__item">
                                          <a href="{% url 'tags_list' tag.slug %}" class="teaser-tags__anchor">
                                            <span class="teaser-tags__title">{{ tag.title }}</span>
                                          </a>
                                        </li>
                                      {% endif %}
                                    {% endfor %}
                                  {% elif settings.core.SiteSettings.enable_clickable_tags %}
                                    {% for tag in next_article.tags_list %}
                                      <li class="teaser-tags__item">
                                        <span class="teaser-tags__title">{{tag}}</span>
                                      </li>
                                    {% endfor %}
                                  {% endif %}
                                {% endif %}
                              </ul>
                              <a href="{% pageurl next_article.specific %}" class="teaser-stacklist__anchor">
                                <h3 class="teaser-stacklist__title {% if next_article.title_highlight %}teaser-stacklist__title--highlight{% endif %}">
                                  {% if next_article.title_highlight %}
                                    {{ next_article.title_highlight|smarttruncatechars:50|safe}}
                                  {% else %}
                                    {{ next_article.title|smarttruncatechars:50|safe}}
                                  {% endif %}
                                </h3>
                              </a>
                              {% if next_article.subtitle_highlight or next_article.body_highlight %}
                                <p class="teaser-stacklist__subtitle">
                                  {% if next_article.subtitle_highlight %}
                                    {{next_article.subtitle_highlight|smarttruncatechars:50|safe}}
                                  {% elif next_article.body_highlight %}
                                    {{next_article.body_highlight|smarttruncatechars:50|safe}}
                                  {% endif %}
                                </p>
                              {% elif next_article.subtitle %}
                                <p class="teaser-stacklist__subtitle">
                                  {{ next_article.subtitle|smarttruncatechars:50|safe}}
                                </p>
                              {% endif %}
                              <a class="call-to-action__button call-to-action__button--primary" href="{% pageurl next_article.specific %}">
                                {% trans "Read more" %}
                              </a>
                          </div>
                        </li>
                      </ul>
                    {% endfor %}
                  </div>
                {% endif %}

              </div>
          </div>
          <div class="section-page__second-column">
            {% if ancestor %}{% load_child_sections_for_section ancestor as sections %}
            {% elif parent %}{% load_child_sections_for_section parent as sections %}
            {% elif self %}{% load_child_sections_for_section self as sections %}{% endif %}
            {% for section in sections %}
              <div class="heading">
                <h1 class="heading__subheading">{{section}}</h1>
              </div>
                {% load_child_articles_for_section section as articles %}
                  <ul class="teaser-stacklist teaser-stacklist--watch">
                    {% for article in articles %}
                      <li class="teaser-stacklist__item">
                        {% if article.homepage_media %}
                          {% for block in article.homepage_media %}
                            {% with block.value as media %}
                              <div class="teaser-stacklist__images">
                                {% if article.get_effective_image %}
                                  <div class="teaser-stacklist__images">
                                    <a href="{% pageurl article.specific %}" class="teaser-stacklist__anchor">
                                      {% image article.get_effective_image width-480 format-jpeg as teaser_thumbnail %}
                                      <img alt="{{ article.title }}" src="{{ teaser_thumbnail.url }}" class="teaser-stacklist__thumbnail" />
                                    </a>
                                  </div>
                                {% endif %}
                              </div>
                            {% endwith %}
                          {% endfor %}
                        {% elif article.get_effective_image %}
                          <div class="teaser-stacklist__images">
                            <a href="{% pageurl article.specific %}" class="teaser-stacklist__anchor">
                              {% image article.get_effective_image width-480 format-jpeg as teaser_thumbnail %}
                              <img alt="{{ article.title }}" src="{{ teaser_thumbnail.url }}" class="teaser-stacklist__thumbnail" />
                            </a>
                          </div>
                        {% endif %}
                      {% include "core/section_page-partials/section_video-article-teaser.html" %}
                      </li>
                    {% endfor %}
                  </ul>
                {% load_child_sections_for_section section=section as inner_sections %}
                  <ul class="teaser-accordion-list teaser-accordion-list--watch">
                      {% for inner_section in inner_sections %}
                        <li class="teaser-accordion-list__item">
                          <!-- INLINE CSS -->
                            <style media="screen">
                              .teaser-accordion-list__{{section|slugify}}-{{inner_section|slugify}} + * {
                                height: auto;
                                opacity: 0;
                                display: none;
                                visibility: hidden;
                                transition: visibility 0.2s, opacity 0.5s ease-out;
                              }
                              .teaser-accordion-list__{{section|slugify}}-{{inner_section|slugify}}:checked + * {
                                display: block;
                                visibility: visible;
                                opacity: 1;
                              }
                            </style>
                          <label for="teaser_accordion_{{section|slugify}}-{{inner_section|slugify}}" class="teaser-accordion-list__anchor">{{inner_section}}</label>
                          <input type="checkbox" value="accordion" name="accordion" id="teaser_accordion_{{section|slugify}}-{{inner_section|slugify}}" class="teaser-accordion-list__{{section|slugify}}-{{inner_section|slugify}}" />
                          {% load_child_articles_for_section inner_section as articles %}
                          {% if articles %}
                            <ul class="teaser-stacklist teaser-stacklist--watch">
                              {% for article in articles %}
                                <li class="teaser-stacklist__item">
                                  {% if article.homepage_media %}
                                    {% for block in article.homepage_media %}
                                      {% with block.value as media %}
                                        <div class="teaser-stacklist__images">
                                          {% if article.get_effective_image %}
                                            <div class="teaser-stacklist__images">
                                              <a href="{% pageurl article.specific %}" class="teaser-stacklist__anchor">
                                                {% image article.get_effective_image width-480 format-jpeg as teaser_thumbnail %}
                                                <img alt="{{ article.title }}" src="{{ teaser_thumbnail.url }}" class="teaser-stacklist__thumbnail" />
                                              </a>
                                            </div>
                                          {% endif %}
                                        </div>
                                      {% endwith %}
                                    {% endfor %}
                                  {% elif article.get_effective_image %}
                                      <div class="teaser-stacklist__images">
                                        <a href="{% pageurl article.specific %}" class="teaser-stacklist__anchor">
                                          {% image article.get_effective_image width-480 format-jpeg as teaser_thumbnail %}
                                          <img alt="{{ article.title }}" src="{{ teaser_thumbnail.url }}" class="teaser-stacklist__thumbnail" />
                                        </a>
                                      </div>
                                  {% endif %}
                                  {% include "core/section_page-partials/section_video-article-teaser.html" %}
                                </li>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </li>
                      {% endfor %}
                  </ul>
            {% endfor %}
          </div>
        </div>

      {% elif ancestor.get_main_language_page.title == "Listen" or parent.get_main_language_page.title == "Listen" or self.get_main_language_page.title == "Listen" %}
        <div class="section-page__columns section-page__columns--listen">
          <div class="section-page__first-column section-page__first-column--listen">
            <div class="heading heading--listen">
              <h1 class="heading__component">{% trans "Featured episode" %}</h1>
            </div>
            {% load_child_articles_for_section self count=1 as articles %}
            {% if articles %}
              <div class="article-teaser__wrapper">
                  <ul class="teaser-stacklist teaser-stacklist--listen">
                    {% for article in articles %}
                      <li class="teaser-stacklist__item">
                        {% include "core/section_page-partials/section_audio-article-teaser.html" %}
                      </li>
                    {% endfor %}
                  </ul>
              </div>
            {% endif %}
          </div>
          <div class="section-page__second-column section-page__second-column--listen">
            {% if ancestor %}{% load_child_sections_for_section ancestor as sections %}
            {% elif parent %}{% load_child_sections_for_section parent as sections %}
            {% elif self %}{% load_child_sections_for_section self as sections %}{% endif %}
            {% for section in sections %}
              <div class="heading">
                <h1 class="heading__subheading">{{section}}</h1>
              </div>
              {% load_child_articles_for_section section as articles %}
              {% if articles %}
                <div class="article-teaser__wrapper">
                    <ul class="teaser-stacklist teaser-stacklist--listen">
                      {% for article in articles %}
                        <li class="teaser-stacklist__item">
                          {% include "core/section_page-partials/section_audio-article-teaser.html" %}
                        </li>
                      {% endfor %}
                    </ul>
                </div>
              {% endif %}
              {% load_child_sections_for_section section=section as inner_sections %}
                <ul class="teaser-accordion-list teaser-accordion-list--listen">
                  {% for inner_section in inner_sections %}
                    <li class="teaser-accordion-list__item">
                      <!-- INLINE CSS -->
                        <style media="screen">
                          .teaser-accordion-list__{{section|slugify}}-{{inner_section|slugify}} + * {
                            height: auto;
                            opacity: 0;
                            display: none;
                            visibility: hidden;
                            transition: visibility 0.2s, opacity 0.5s ease-out;
                          }
                          .teaser-accordion-list__{{section|slugify}}-{{inner_section|slugify}}:checked + * {
                            display: block;
                            visibility: visible;
                            opacity: 1;
                          }
                        </style>
                      <label for="teaser_accordion_{{section|slugify}}-{{inner_section|slugify}}" class="teaser-accordion-list__anchor">{{inner_section}}</label>
                      <input type="checkbox" value="accordion_audio" name="accordion_audio" id="teaser_accordion_{{section|slugify}}-{{inner_section|slugify}}" class="teaser-accordion-list__{{section|slugify}}-{{inner_section|slugify}}" />
                      {% load_child_articles_for_section inner_section as articles %}
                      {% if articles %}
                        <ul class="teaser-stacklist teaser-stacklist--listen">
                          {% for article in articles %}
                            <li class="teaser-stacklist__item">
                              {% include "core/section_page-partials/section_audio-article-teaser.html" %}
                            </li>
                          {% endfor %}
                        </ul>
                      {% endif %}
                    </li>
                  {% endfor %}
                </ul>
            {% endfor %}
          </div>
        </div>

      {% elif self.get_main_language_page.title == "News" %}
        <div class="section-page--general section-page__wrapper">
          <div class="article-teaser article-teaser--general">
            <div class="article-teaser__wrapper">
              {% load_child_articles_for_section self as articles %}
              {% if articles %}
                <ul class="teaser-stacklist">
                  <!-- LOAD CHILD SECTION FOR SELF AGAIN:  -->
                    {% for article in articles %}
                      {% include "core/section_page-partials/section_article-teaser.html" with teaser_type="stacklist" %}
                    {% endfor %}
                </ul>
              {% endif %}
            </div>
          </div>
        </div>

      {% elif self.get_main_language_page.title == "Cast" %}
        <div class="section-page__wrapper section-page--characters">
          <div class="article-teaser article-teaser--sidebar">
            <div class="article-teaser__wrapper">
              {% load_child_articles_for_section self as articles %}
              {% if articles %}
                <ul class="teaser-grid">
                  <!-- LOAD CHILD SECTION FOR SELF AGAIN:  -->
                    {% for article in articles %}
                      {% include "core/section_page-partials/section_article-teaser.html" with teaser_type="grid" %}
                    {% endfor %}
                </ul>
              {% endif %}
            </div>
          </div>
        </div>
      {% endif %}
    {% endwith %}
  </div>
{% endblock %}
